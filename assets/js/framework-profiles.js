// ThemeForest Validator Pro - Framework Profiles
// Profils de validation sp√©cifiques par type de framework

const FRAMEWORK_PROFILES = {
    html: {
        name: "HTML/CSS/JS Template",
        icon: "üåê",
        color: "blue",
        description: "Template HTML statique avec CSS et JavaScript",
        enabledCategories: [
            'structure', 'htmlQuality', 'cssQuality', 'jsQuality', 
            'designUIUX', 'performance', 'accessibility', 'seo', 
            'security', 'browserCompatibility', 'codeQuality',
            'documentation', 'demoPreview', 'requiredFiles', 
            'thirdPartyResources', 'manualTests'
        ],
        specificChecks: {
            structure: {
                additionalChecks: [
                    {
                        name: "Fichier favicon.ico",
                        required: true,
                        severity: "medium",
                        points: 5,
                        description: "Favicon pr√©sent √† la racine du template",
                        fix: "Ajoutez un fichier favicon.ico √† la racine de votre template"
                    }
                ]
            },
            htmlQuality: {
                additionalChecks: [
                    {
                        name: "Balises meta Open Graph",
                        required: false,
                        severity: "medium",
                        points: 8,
                        description: "Meta tags Open Graph pour le partage social",
                        fix: "Ajoutez les meta tags Open Graph (og:title, og:description, og:image)"
                    }
                ]
            }
        }
    },

    wordpress: {
        name: "WordPress Theme",
        icon: "WP",
        color: "darkblue",
        description: "Th√®me WordPress avec fonctionnalit√©s sp√©cifiques",
        enabledCategories: [
            'structure', 'htmlQuality', 'cssQuality', 'jsQuality', 
            'designUIUX', 'performance', 'accessibility', 'seo', 
            'security', 'browserCompatibility', 'codeQuality',
            'documentation', 'demoPreview', 'requiredFiles', 
            'thirdPartyResources', 'manualTests', 'wordpressSpecific'
        ],
        specificChecks: {
            structure: {
                additionalChecks: [
                    {
                        name: "Fichier style.css avec header",
                        required: true,
                        severity: "critical",
                        points: 20,
                        description: "Le fichier style.css doit contenir l'en-t√™te WordPress requis",
                        fix: "Ajoutez l'en-t√™te WordPress dans style.css avec Theme Name, Description, Version, etc."
                    },
                    {
                        name: "Fichier functions.php",
                        required: true,
                        severity: "critical",
                        points: 15,
                        description: "Le fichier functions.php est requis pour les th√®mes WordPress",
                        fix: "Cr√©ez un fichier functions.php avec les fonctions de base du th√®me"
                    },
                    {
                        name: "Templates de base WordPress",
                        required: true,
                        severity: "high",
                        points: 12,
                        description: "Templates WordPress de base (index.php, header.php, footer.php)",
                        fix: "Cr√©ez les templates WordPress de base : index.php, header.php, footer.php"
                    }
                ]
            },
            security: {
                additionalChecks: [
                    {
                        name: "√âchappement des donn√©es WordPress",
                        required: true,
                        severity: "critical",
                        points: 15,
                        description: "Utilisation des fonctions d'√©chappement WordPress (esc_html, esc_attr, etc.)",
                        fix: "Utilisez les fonctions d'√©chappement WordPress pour toutes les sorties de donn√©es"
                    },
                    {
                        name: "Nonces WordPress",
                        required: true,
                        severity: "high",
                        points: 10,
                        description: "Utilisation des nonces WordPress pour la s√©curit√© des formulaires",
                        fix: "Impl√©mentez les nonces WordPress pour tous vos formulaires et actions AJAX"
                    }
                ]
            }
        }
    },

    react: {
        name: "React Application",
        icon: "‚öõÔ∏è",
        color: "cyan",
        description: "Application React moderne avec composants",
        enabledCategories: [
            'structure', 'jsQuality', 'designUIUX', 'performance', 
            'accessibility', 'seo', 'security', 'browserCompatibility', 
            'codeQuality', 'documentation', 'demoPreview', 
            'requiredFiles', 'thirdPartyResources', 'manualTests'
        ],
        specificChecks: {
            structure: {
                additionalChecks: [
                    {
                        name: "Fichier package.json valide",
                        required: true,
                        severity: "critical",
                        points: 20,
                        description: "Le fichier package.json doit √™tre pr√©sent et valide",
                        fix: "Assurez-vous que package.json contient toutes les d√©pendances et scripts n√©cessaires"
                    },
                    {
                        name: "Structure src/ organis√©e",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Le dossier src/ doit √™tre bien organis√© (components/, pages/, utils/, etc.)",
                        fix: "Organisez votre code React dans des dossiers logiques (components, pages, hooks, utils)"
                    },
                    {
                        name: "Fichier README avec instructions React",
                        required: true,
                        severity: "high",
                        points: 12,
                        description: "README avec instructions sp√©cifiques React (npm start, build, etc.)",
                        fix: "Documentez les commandes React (npm start, npm run build, npm test)"
                    }
                ]
            },
            jsQuality: {
                additionalChecks: [
                    {
                        name: "Composants React fonctionnels",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Utilisation de composants fonctionnels avec hooks",
                        fix: "Privil√©giez les composants fonctionnels avec hooks plut√¥t que les classes"
                    },
                    {
                        name: "PropTypes ou TypeScript",
                        required: false,
                        severity: "medium",
                        points: 10,
                        description: "Validation des props avec PropTypes ou TypeScript",
                        fix: "Ajoutez PropTypes ou utilisez TypeScript pour valider les props"
                    },
                    {
                        name: "Gestion d'√©tat appropri√©e",
                        required: true,
                        severity: "medium",
                        points: 12,
                        description: "Gestion d'√©tat avec useState, useContext ou Redux selon la complexit√©",
                        fix: "Utilisez la gestion d'√©tat appropri√©e (useState pour local, Context/Redux pour global)"
                    }
                ]
            },
            performance: {
                additionalChecks: [
                    {
                        name: "Code splitting React",
                        required: false,
                        severity: "medium",
                        points: 10,
                        description: "Utilisation du code splitting avec React.lazy et Suspense",
                        fix: "Impl√©mentez le code splitting pour les composants lourds avec React.lazy"
                    },
                    {
                        name: "Optimisation des re-renders",
                        required: true,
                        severity: "medium",
                        points: 8,
                        description: "Optimisation avec useMemo, useCallback, React.memo",
                        fix: "Optimisez les re-renders avec useMemo, useCallback et React.memo"
                    }
                ]
            }
        }
    },

    vue: {
        name: "Vue.js Application",
        icon: "üü¢",
        color: "green",
        description: "Application Vue.js avec composants single-file",
        enabledCategories: [
            'structure', 'jsQuality', 'designUIUX', 'performance', 
            'accessibility', 'seo', 'security', 'browserCompatibility', 
            'codeQuality', 'documentation', 'demoPreview', 
            'requiredFiles', 'thirdPartyResources', 'manualTests'
        ],
        specificChecks: {
            structure: {
                additionalChecks: [
                    {
                        name: "Fichier vue.config.js",
                        required: false,
                        severity: "medium",
                        points: 8,
                        description: "Configuration Vue.js personnalis√©e si n√©cessaire",
                        fix: "Cr√©ez un fichier vue.config.js pour les configurations personnalis√©es"
                    },
                    {
                        name: "Structure Vue recommand√©e",
                        required: true,
                        severity: "high",
                        points: 12,
                        description: "Structure de dossiers Vue.js recommand√©e (components/, views/, router/, store/)",
                        fix: "Organisez votre projet selon la structure Vue.js recommand√©e"
                    }
                ]
            },
            jsQuality: {
                additionalChecks: [
                    {
                        name: "Composants Single File Components",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Utilisation de Single File Components (.vue)",
                        fix: "Organisez votre code en Single File Components avec template, script et style"
                    },
                    {
                        name: "Composition API ou Options API coh√©rent",
                        required: true,
                        severity: "medium",
                        points: 10,
                        description: "Utilisation coh√©rente de Composition API ou Options API",
                        fix: "Choisissez et utilisez de mani√®re coh√©rente soit Composition API soit Options API"
                    }
                ]
            }
        }
    },

    angular: {
        name: "Angular Application",
        icon: "üÖ∞Ô∏è",
        color: "red",
        description: "Application Angular avec TypeScript",
        enabledCategories: [
            'structure', 'jsQuality', 'designUIUX', 'performance', 
            'accessibility', 'seo', 'security', 'browserCompatibility', 
            'codeQuality', 'documentation', 'demoPreview', 
            'requiredFiles', 'thirdPartyResources', 'manualTests'
        ],
        specificChecks: {
            structure: {
                additionalChecks: [
                    {
                        name: "Fichier angular.json",
                        required: true,
                        severity: "critical",
                        points: 20,
                        description: "Configuration Angular workspace valide",
                        fix: "Assurez-vous que angular.json est pr√©sent et correctement configur√©"
                    },
                    {
                        name: "Structure Angular CLI",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Structure g√©n√©r√©e par Angular CLI respect√©e",
                        fix: "Respectez la structure de dossiers g√©n√©r√©e par Angular CLI"
                    }
                ]
            },
            jsQuality: {
                additionalChecks: [
                    {
                        name: "TypeScript strict mode",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Configuration TypeScript en mode strict",
                        fix: "Activez le mode strict de TypeScript dans tsconfig.json"
                    },
                    {
                        name: "Services et Dependency Injection",
                        required: true,
                        severity: "medium",
                        points: 12,
                        description: "Utilisation appropri√©e des services et de l'injection de d√©pendances",
                        fix: "Organisez votre logique m√©tier dans des services avec injection de d√©pendances"
                    }
                ]
            }
        }
    },

    bootstrap: {
        name: "Bootstrap Template",
        icon: "üÖ±Ô∏è",
        color: "purple",
        description: "Template utilisant Bootstrap framework",
        enabledCategories: [
            'structure', 'htmlQuality', 'cssQuality', 'jsQuality', 
            'designUIUX', 'performance', 'accessibility', 'seo', 
            'security', 'browserCompatibility', 'codeQuality',
            'documentation', 'demoPreview', 'requiredFiles', 
            'thirdPartyResources', 'manualTests'
        ],
        specificChecks: {
            cssQuality: {
                additionalChecks: [
                    {
                        name: "Utilisation appropri√©e des classes Bootstrap",
                        required: true,
                        severity: "high",
                        points: 15,
                        description: "Utilisation correcte et s√©mantique des classes Bootstrap",
                        fix: "Utilisez les classes Bootstrap de mani√®re s√©mantique et √©vitez la sur-utilisation"
                    },
                    {
                        name: "Personnalisation Bootstrap coh√©rente",
                        required: true,
                        severity: "medium",
                        points: 10,
                        description: "Personnalisation coh√©rente des variables Bootstrap",
                        fix: "Personnalisez Bootstrap via les variables SCSS plut√¥t que par surcharge CSS"
                    }
                ]
            },
            designUIUX: {
                additionalChecks: [
                    {
                        name: "Syst√®me de grille Bootstrap ma√Ætris√©",
                        required: true,
                        severity: "high",
                        points: 12,
                        description: "Utilisation appropri√©e du syst√®me de grille Bootstrap",
                        fix: "Ma√Ætrisez le syst√®me de grille Bootstrap (containers, rows, cols) pour tous les breakpoints"
                    }
                ]
            }
        }
    }
};

// Fonction de d√©tection automatique du framework
const FRAMEWORK_DETECTION = {
    detectFramework: function(files) {
        const fileNames = files.map(f => f.name.toLowerCase());
        const fileContents = files.map(f => f.content || '').join(' ').toLowerCase();

        // D√©tection WordPress
        if (fileNames.includes('style.css') && fileNames.includes('functions.php')) {
            return 'wordpress';
        }
        if (fileNames.includes('index.php') || fileContents.includes('wp_')) {
            return 'wordpress';
        }

        // D√©tection React
        if (fileNames.includes('package.json')) {
            if (fileContents.includes('"react"') || fileContents.includes('react-scripts')) {
                return 'react';
            }
        }
        if (fileContents.includes('import react') || fileContents.includes('from \'react\'')) {
            return 'react';
        }

        // D√©tection Vue.js
        if (fileNames.some(name => name.endsWith('.vue'))) {
            return 'vue';
        }
        if (fileContents.includes('vue') && fileNames.includes('package.json')) {
            return 'vue';
        }

        // D√©tection Angular
        if (fileNames.includes('angular.json') || fileNames.includes('angular-cli.json')) {
            return 'angular';
        }
        if (fileContents.includes('@angular/') || fileContents.includes('ng ')) {
            return 'angular';
        }

        // D√©tection Bootstrap
        if (fileContents.includes('bootstrap') || fileContents.includes('bs-')) {
            return 'bootstrap';
        }

        // Par d√©faut : HTML
        return 'html';
    },

    getFrameworkProfile: function(frameworkType) {
        return FRAMEWORK_PROFILES[frameworkType] || FRAMEWORK_PROFILES.html;
    },

    mergeProfileWithCriteria: function(profile, baseCriteria) {
        const mergedCriteria = { ...baseCriteria };

        // Filtrer les cat√©gories selon le profil
        Object.keys(mergedCriteria).forEach(categoryKey => {
            if (!profile.enabledCategories.includes(categoryKey)) {
                delete mergedCriteria[categoryKey];
            }
        });

        // Ajouter les v√©rifications sp√©cifiques du profil
        if (profile.specificChecks) {
            Object.keys(profile.specificChecks).forEach(categoryKey => {
                if (mergedCriteria[categoryKey] && profile.specificChecks[categoryKey].additionalChecks) {
                    mergedCriteria[categoryKey].checks = [
                        ...mergedCriteria[categoryKey].checks,
                        ...profile.specificChecks[categoryKey].additionalChecks
                    ];
                }
            });
        }

        return mergedCriteria;
    }
};

// Export pour utilisation dans le validateur principal
if (typeof module !== 'undefined' && module.exports) {
    module.exports = { FRAMEWORK_PROFILES, FRAMEWORK_DETECTION };
}

